<!DOCTYPE html>
<html lang="en" class="no-js">

<head>

  <!--- basic page needs
    ================================================== -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Han Meerholz</title>

  <script>
    document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('js');
  </script>

  <!-- CSS
    ================================================== -->
  <link rel="stylesheet" href="css/vendor.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/highlight/atom-one-dark.min.css">

  <!-- favicons
    ================================================== -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">

</head>


<body id="top">


  <!-- preloader
    ================================================== -->
  <div id="preloader">
    <div id="loader" class="line"></div>
  </div>


  <!-- page wrap
    ================================================== -->
  <div id="page" class="s-pagewrap">


    <!-- # site header 
        ================================================== -->
    <header id="masthead" class="s-header">

      <div class="s-header__block">
        <div class="s-header__branding">
          <p class="site-title">
            <a href="index.html" rel="home">Han</a>
          </p>
        </div>

        <a class="s-header__menu-toggle" href="#0"><span>Menu</span></a>
      </div> <!-- end s-header__block -->

      <div class="row s-header__nav-wrap">
        <ul class="s-header__social">
          <li>
            <a href="https://www.linkedin.com/in/han-meerholz/">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 448 512"
                style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z">
                </path>
              </svg>

              <span class="u-screen-reader-text">LinkedIn</span>
            </a>
          </li>
          <li>
            <a href="https://github.com/HanMeerholz/">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M12.026 2c-5.509 0-9.974 4.465-9.974 9.974 0 4.406 2.857 8.145 6.821 9.465.499.09.679-.217.679-.481 0-.237-.008-.865-.011-1.696-2.775.602-3.361-1.338-3.361-1.338-.452-1.152-1.107-1.459-1.107-1.459-.905-.619.069-.605.069-.605 1.002.07 1.527 1.028 1.527 1.028.89 1.524 2.336 1.084 2.902.829.091-.645.351-1.085.635-1.334-2.214-.251-4.542-1.107-4.542-4.93 0-1.087.389-1.979 1.024-2.675-.101-.253-.446-1.268.099-2.64 0 0 .837-.269 2.742 1.021a9.582 9.582 0 0 1 2.496-.336 9.554 9.554 0 0 1 2.496.336c1.906-1.291 2.742-1.021 2.742-1.021.545 1.372.203 2.387.099 2.64.64.696 1.024 1.587 1.024 2.675 0 3.833-2.33 4.675-4.552 4.922.355.308.675.916.675 1.846 0 1.334-.012 2.41-.012 2.737 0 .267.178.577.687.479C19.146 20.115 22 16.379 22 11.974 22 6.465 17.535 2 12.026 2z">
                </path>
              </svg>
              <span class="u-screen-reader-text">Github</span>
            </a>
          </li>
          <li>
            <a href="https://theanachronist.itch.io/">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32"
                style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M 16 5 C 12.748 5 8.3121094 5.0508594 7.4121094 5.1308594 C 6.4021094 5.7368594 4.4028125 8.0309531 4.3828125 8.6269531 L 4.3828125 9.6269531 C 4.3828125 10.889953 5.5657188 12 6.6367188 12 C 7.9197187 12 8.9902344 10.929969 8.9902344 9.6679688 C 8.9902344 10.929969 10.0305 12 11.3125 12 C 12.6055 12 13.605469 10.930969 13.605469 9.6679688 C 13.605469 10.929969 14.695281 12 15.988281 12 L 16.009766 12 C 17.302766 12 18.392578 10.930969 18.392578 9.6679688 C 18.392578 10.929969 19.402547 12 20.685547 12 C 21.968547 12 23.009766 10.930969 23.009766 9.6679688 C 23.009766 10.929969 24.080281 12 25.363281 12 C 26.434281 12 27.615234 10.889953 27.615234 9.6269531 L 27.615234 8.6269531 C 27.595234 8.0309531 25.595938 5.7368594 24.585938 5.1308594 C 21.443938 5.0198594 19.252 5 16 5 z M 13.550781 11.742188 C 12.497781 13.552188 9.8523125 13.573906 8.8203125 11.753906 C 8.1903125 12.845906 6.7642969 13.267547 6.1542969 13.060547 C 5.9762969 14.959547 5.8534844 24.70875 7.1464844 26.34375 C 10.943484 27.22875 21.164516 27.20975 24.853516 26.34375 C 26.348516 24.81975 26.013703 14.821547 25.845703 13.060547 C 25.235703 13.267547 23.809453 12.845906 23.189453 11.753906 C 22.146453 13.573906 19.501219 13.552188 18.449219 11.742188 C 18.124219 12.332187 17.367 13.109375 16 13.109375 C 14.997 13.148375 14.051781 12.607187 13.550781 11.742188 z M 11.419922 14 C 12.219922 14 12.950078 14.000469 13.830078 14.980469 C 15.280078 14.830469 16.719922 14.830469 18.169922 14.980469 C 19.059922 14.010469 19.780078 14.009766 20.580078 14.009766 C 23.160078 14.009766 23.780937 17.819609 24.710938 21.099609 C 25.550938 24.149609 24.429062 24.230469 23.039062 24.230469 C 20.969062 24.150469 19.820313 22.650625 19.820312 21.140625 C 17.890313 21.460625 14.809688 21.580625 12.179688 21.140625 C 12.179688 22.650625 11.030938 24.150469 8.9609375 24.230469 C 7.5709375 24.230469 6.4490625 24.149609 7.2890625 21.099609 C 8.2190625 17.799609 8.8399219 14.009766 11.419922 14.009766 L 11.419922 14 z M 16 16.876953 C 16 16.876953 14.306 18.439375 14 18.984375 L 15.107422 18.943359 L 15.107422 19.910156 C 15.107422 19.968156 15.926 19.917969 16 19.917969 C 16.447 19.934969 16.892578 19.951156 16.892578 19.910156 L 16.892578 18.943359 L 18 18.984375 C 17.694 18.438375 16 16.876953 16 16.876953 z" />
              </svg>
              <span class="u-screen-reader-text">Itch.io</span>
            </a>
          </li>
        </ul> <!-- end s-header__social -->
      </div> <!-- end s-header__nav-wrap -->
    </header> <!-- end s-header -->

    <section id="blog" class="s-about">
      <div class="row">
        <div class="column lg-12">
          <h1>Bequestor: <br> A Versatile Quest System</h1>

          <h2>Introduction</h2>

          <p>
            Quest systems are omnipresent in videogames, and have evolved far beyond the simple "kill 10 goblins in the
            woods"
            present in classic RPGs. Nowadays, you can find some kind of quest system in anything from modern RPGs like
            Cyberpunk 2077 to Metroidvanias like Hollow Knight: Silksong; from sandbox games like Minecraft, to Discord
            (yes,
            the social platform).
          </p>

          <p>
            <em>But how do you go about creating your own quest system for a game? How do you even define a quest in the
              first place?</em>
          </p>

          <p>
            To answer this, I have created my own quest design tool and quest system C++ library, <em>Bequestor</em>.
            In this blog post, I will show how to use this tool for yourself, and for those more technically inclined
            and
            interested, there are additional sections on implementation details.
          </p>

          <div class="column">
            <img src="images/blog/quest_creator_full_quest.png"
              alt="Quest creation window with visible quest with multiple prerequisites and objectives, some of which are collapsed; the second objective has custom parameters and is dependent on the first.">
          </div>
          <div class="column">
            <img src="images/blog/quest_sample_game.png" alt="Quest game window showing quest progression.">
          </div>

          <h2>Setup</h2>

          <p>
            This tool consists of two parts: the <em>Quest Creator</em>, a quest creation tool written in Python in
            which you can create, edit,
            import, and export quests to a JSON format; and the <em>Bequestor Library</em> a C++ library which can read
            this JSON file, store the
            quests, and update them.
          </p>

          <h3>Quest Creator</h3>

          <p>
            In order to run the quest creator tool, traverse to the <code class="hljs">quest_creator</code> folder,
            create a virtual
            environment, open the command prompt, and execute the following commands:
          </p>

          <pre><code class="language-plaintext">pip install -r requirements.txt
python quest_creation_tool.py</code></pre>

          <p>
            Alternatively, you can run the <code class=" hljs">runme.bat</code> file, which creates a virtual
            environment
            and executes
            the commands for you.
          </p>

          <p>
            If you use Visual Studio Code, you can also do the following:
            Press <code class="hljs">Ctrl+Shift+P</code> &rarr; Python: Create Environment... &rarr; Venv &rarr; Select
            Python
            version &rarr; check <code class="hljs">requirements.txt</code> &rarr; press OK.<br>
            Then simply open <code class="hljs">quest_creation_tool.py</code> and run it from the editor.
          </p>

          <h3>Bequestor Library</h3>
          <p>
            TODO figure this out
          </p>

          <h2>Creating a simple quest</h2>

          <h3>Basic information</h3>

          <p>
            When opening the Quest Creator tool, you are greeted with the following screen:
          </p>

          <img src="images/blog/quest_creator_startup.png"
            alt="Quest creation window with buttons for &quot;Add Quest&quot;, &quot;Import&quot;, &quot;Export&quot;, and &quot;Quit&quot;.">

          <p>
            You can now press "Add Quest" to add a quest and give it a name and description. You can also collapse or
            delete your created quest with the buttons to the right. You can add as many quests as you want, but it is
            recommended to give them different names.
          </p>

          <h3>Prerequisites</h3>

          <p>
            For each quest, you can specify a number of prerequisites. If all of the prerequisites are met, the quest
            will start. There are 4 preset prerequisite types, and a custom type you can select. For now, let's focus
            on the presets and specify some prerequisites.
          </p>

          <img src="images/blog/quest_creator_preset_prereqs.png"
            alt="Quest creation window with a &quot;Becoming Batman&quot; quest with a simple description and two prerequisites: is in &quot;Batcave&quot; and has 10 &quot;Batarangs&quot;.">

          <h3>Objectives</h3>

          <p>
            Finally, you can specify a number of objectives for a quest. These start updating as soon as the quest is
            started, and when all (non-optional) objectives are complete, the quest will finish. Once again, we specify
            some preset
            objectives. We will discuss custom objectives, dependencies, and optionality later.
          </p>

          <img src="images/blog/quest_creator_preset_objectives.png"
            alt="Quest creation window with two objecitves specified: talk to &quot;Alfred&quot;, and kill 1 bat.">

          <h3>Export / Import</h3>

          <p>
            You can now export your quest by pressing the "Export" button and specifying a file name and location,
            and quit the tool by pressing "Quit". If you later want to edit these quests again, just reopen the tool,
            then press "Import" and select the JSON file to which you exported before.
          </p>

          <img src="images/blog/quest_creator_export_quest.png"
            alt="Save dialogue. The quest is being saved as &quot;batman_quests.json&quot;.">

          <h2>Registering your quests to your game</h2>

          <p>
            In order to use the Bequestor library in your own game and use the quest you've just created, we first need
            to create a <code class="hljs">QuestManager</code>. In my game's <code class="hljs">QuestSystem</code>
            header file, I declare a
            pointer
            to it: <code class="hljs">std::shared_ptr&lt;Bequestor::QuestManager> questManager;</code>.
          </p>

          <p>
            Then in the constructor implementation (using the <code class="hljs">std</code> and <code
              class="hljs">Bequestor</code> namespaces) I
            construct the quest manager, and load in the JSON file we exported earlier.
          </p>

          <pre><code>questManager = make_shared&lt;QuestManager>();
questManager->Load("../quest_creator/batman_quests.json");</code></pre>

          <p>
            You also need to make sure to call <code class="hljs">QuestManager::Update()</code> whenever you want your
            quests to
            update.
            I call this once per second in my <code class="hljs">UpdatePerTick()</code> function:
            <code class="hljs">void QuestSystem::UpdatePerTick() { questManager->Update(); }</code>
          </p>

          <p>
            Running the game right now works, but every second, I get an error message:
            <code class="hljs">No prerequisite checker for Is In Location exists.</code>

          </p>

          <h3>Register preset prerequisites</h3>

          <p>
            In order to check for the quests' prerequisites, we need some way to actually query your game's state.
            For each of the prerequisites used, we must supply a <code class="hljs">PrerequisiteChecker</code>. Luckily,
            for the
            preset prerequisites this is easy. There are functions available
            <code class="hljs">QuestManager::WithLocationChecker()</code>, <code
              class="hljs">QuestManager::WithItemChecker()</code>,
            <code class="hljs">QuestManager::WithExperienceChecker()</code>, and <code
              class="hljs">QuestManager::WithGoldChecker()</code>. These
            are builder functions and can be called using function chaining. Each of these functions take a function
            argument. For the location checker for example, it expects a function that takes the location id and returns
            whether the player is in that location. For the item checker the function takes an item id and returns the
            number of items of that id that the player has. As an example in my own demo game, which uses an ECS system,
            I've replaced <code class="hljs">questManager = make_shared<QuestManager>()</code> with the following code:
          </p>

          <pre><code>questManager = make_shared&lt;QuestManager>(
QuestManager()
  .WithLocationChecker(
    [](string locationName) -> bool
    {
      for (auto const& [areaEntity, area] : Engine.ECS().Registry.view&lt;Area>().each())
        for (auto const& [playerEntity, player, actor] : Engine.ECS().Registry.view&lt;Player, Actor>().each())
          if (area.name == locationName && GameUtils::IsInBounds(actor.location, area.bounds)) return true;
      return false;
    })
  .WithItemChecker(
    [](string itemName) -> unsigned int
    {
      auto const& playerEntity = Engine.ECS().Registry.view&lt;Player>().front();
      for (auto const& [entity, inventory, item] : Engine.ECS().Registry.view&lt;Inventory, Item>().each())
        if (item.type == itemName && inventory.actorId == playerEntity) return item.amount;
      return 0;
    })
);</code></pre>

          <p>
            Now we can get the active quests with <code class="hljs">QuestManager::GetActiveQuests()</code>. I gave my
            player
            the batarangs at the start of the game. In the first image I had not yet entered the "Batcave" area,
            so the quest did not show up on my ImGUI panel. In the second image, I had entered the Batcave, and
            the quest appeared.
          </p>

          <img src="images/blog/quest_prereq_not_met.png"
            alt="A screenshot of the game where the player is in a grassy area and the quest does not show up in the quest log.">

          <img src="images/blog/quest_prereq_met.png"
            alt="A screenshot of the game where the player in in the cave area and the quest has shown up and is showing the two prerequisites.">

          <h4 class="collapsible">Under the hood</h4>
          <div class="collapsible_content">
            <p>TODO</p>
          </div>
          <h3>Dispatching events</h3>

          <p>
            Now we can start a quest, but we can't finish it yet, because we can't update objectives. In order to do
            this, we need to send out <em>events</em> every time an objective should update. This can be done by
            having your relevant game class(es) implement the <code class="hljs">EventDispatcher</code> class, and call
            the
            <code class="hljs">Notify()</code> function, giving the appropriate event as an argument. My main game class
            implements
            the <code class="hljs">EventDispatcher</code> interface: <code
              class="hljs">class Game : public Bequestor::EventDispatcher</code>.
            For preset objectives, there are functions available to create events under the <code
              class="hljs">ObjectiveEvent</code>
            class. <code class="hljs">MakeNPCEvent()</code> takes the id of the NPC that's interacted with, similar to
            <code class="hljs">MakeLocationEvent()</code>. <code class="hljs">MakeItemEvent()</code> takes the item id
            and the amount of items
            collected, similar to <code class="hljs">MakeKillCreatureEvent()</code>. This is how I send events in my own
            game class:
          </p>

          <pre><code>void Game::interactWithNPC(Actor const& npcActor, Actor const& interactingActor)
{
  Notify(Bequestor::ObjectiveEvent::MakeNPCEvent(npcActor.name));
  // (...)
}</code></pre>

          <pre><code>void Game::killEnemy(/*(...)*/ Actor const& enemyActor, Actor const& killerActor, Player& player)
{
  Notify(Bequestor::ObjectiveEvent::MakeKillCreatureEvent(enemyActor.name, 1u));
  // (...)
}</code></pre>

          <p>
            Finally, we need to add our <code class="hljs">QuestManager</code> as an observer to our <code
              class="hljs">EventDispatcher</code>, so
            our events are actually handled and the objectives are updated. I simply do this in my game's quest system's
            constructor:
          </p>

          <pre><code>QuestSystem::QuestSystem(EventDispatcher& dispatcher)
{
  // (...)
  dispatcher.AddObserver(questManager);
}</code></pre>

          <p>
            In the demo game, I've started the quest by entering the cave. In the first image the player has not yet
            interacted with the NPC. In the second objective the player did interact with the NPC named "Alfred", and
            the first objective is shown as being completed. In the third image, the player has killed a bat, and since
            that satisfies the second objective, the quest is completed and removed from the active quests. The quest
            log is empty again.
          </p>
          <img src="images/blog/quest_objectives_not_met.png"
            alt="A screenshot of the game where the player is in the cave area standing next to an NPC. The quest log shows the quest with uncompleted objectives.">

          <img src="images/blog/quest_objective_1_met.png"
            alt="A screenshot of the game where the player in in the cave area having interacted with the NPC (indicated in the command line). The quest log shows that the first objective of the quest is completed.">

          <img src="images/blog/quest_objectives_met.png"
            alt="A screenshot of the game where the player in in the cave area having just killed a bat (indicated in the command line). The quest log is empty again.">

          <h4 class="collapsible">Under the hood</h4>
          <div class="collapsible_content">
            <p>TODO</p>
          </div>

          <h2 class="collapsible">Advanced Features</h2>
          <div class="collapsible_content">
            <h3>Custom parameters</h3>
            <p>
              Only being able to create prerequisites or objectives of 4 preset types can be very limiting. Any specific
              game would have unique kinds of prerequisites and objectives that need to be specified. The Quest Creator
              tool allows for this through custom types and parameters. Let's open the tool, import our
              <code class="hljs">batman_quests.json</code>, and update it to use custom prerequisites and objectives.
              I'll remove the
              second "Kill Creatures" objective, and replace it with a custom objective. We name the custom type "Do
              Nothing" (to become Batman, one must be patient). Now we can add any number of custom parameters. For each
              of these parameters we can specify a type, name, and value. Let's add a float named "seconds" and give it
              a
              value of <code class="hljs">5.0</code>. We must do nothing for 5 seconds. Let's also add a custom
              prerequisite. To
              start
              the quest, we can't have walked more than 10 steps. Let's export it again, and overwrite the
              <code class="hljs">batman_quests.json</code> file.
            </p>

            <img src="images/blog/quest_creator_custom_objective.png"
              alt="Quest creation window showing the objectives, among which a custom objective with a custom &quot;Do Nothing&quot; type and a &quot;seconds&quot; float parameter set to 5.0.">
            <img src="images/blog/quest_creator_custom_prerequisite.png"
              alt="Quest creation window showing the prerequisites, among which a custom prerequisite with a custom &quot;Walked At Most&quot; type and a &quot;steps&quot; integer parameter set to 10.">

            <p>
              In order to use these custom prerequisites and objectives in our own game implementation, we'll need to
              create our own <code class="hljs">PrerequisiteChecker</code> and <code
                class="hljs">ObjectiveChecker</code>. Let's start with the
              <code class="hljs">PrerequisiteChecker</code>. Implementing the <code
                class="hljs">PrerequisiteChecker</code> interface requires us
              to
              implement the <code class="hljs">IsSatisfied()</code> function. We'll make our own
              <code class="hljs">MaxDistanceWalkedChecker</code>
              as follows:
            </p>

            <pre><code>class MaxDistanceWalkedChecker : public Bequestor::PrerequisiteChecker
{
public:
  inline MaxDistanceWalkedChecker(int const& distanceWalked) : distanceWalked(distanceWalked) {}

  bool IsSatisfied(Bequestor::Prerequisite const& prereq) const override;

private:
  int const& distanceWalked;
};</code></pre>

            <p>
              When implementing the <code class="hljs">IsSatisfied()</code> function, we can get the values of our
              custom variables
              through the templated <code class="hljs">Prerequisite::Get()</code> function. In this case, we get an
              integer for the
              specified "steps" parameter.
            </p>

            <pre><code>bool MaxDistanceWalkedChecker::IsSatisfied(Bequestor::Prerequisite const& prereq) const
{
return distanceWalked &lt; prereq.Get&lt;int>("steps");
}</code></pre>

            <p>
              Prerequisites don't keep track of their own state, so instead we provide a reference to a variable in game
              and save it in a member variable.
            </p>

            <p>
              Now we just need to register this checker to our <code class="hljs">QuestManager</code>. For this we can
              use the
              <code class="hljs">WithCustomPrerequisiteChecker()</code> function, which takes a string for the name of
              the checker
              (this needs to be equal to the custom type name specified in the quest creator), and a shared pointer to
              your <code class="hljs">PrerequisiteChecker</code>. We can register the checker as follows (where the
              <code class="hljs">distanceWalked</code> variable is a context variable known by my game):
            </p>

            <pre><code>questManager = make_shared&lt;QuestManager>(
  QuestManager()
    /*(with preset checkers)*/
    .WithCustomPrerequisiteChecker("Walked At Most", make_shared&lt;MaxDistanceWalkedChecker>(distanceWalked))
);</code></pre>

            <p>
              In the demo game, you can see from the two images below that now the quest only shows up in the quest log
              if
              the player hasn't walked more than 10 steps.
            </p>

            <img src="images/blog/quest_custom_prereq_met.png"
              alt="A screenshot of the game where the player in in the cave area and the quest has shown up and is showing the three prerequisites. The console shows the player has walked less than 8 steps.">
            <img src="images/blog/quest_custom_prereq_not_met.png"
              alt="A screenshot of the game where the player in in the cave area and the quest has not shown up. The console shows the player has walked more than 8 steps.">

            <p>
              Now we do still have the problem that as soon as the quest starts, we are spammed with the following
              console
              messages:
            </p>
            <img src="images/blog/no_objective_checker_exists.png"
              alt="A screenshot of the console log with numerous error messages stating &quot;No objective checker for Do Nothing&quot;.">

            <p>
              It appears we need to create a custom <code class="hljs">ObjectiveChecker</code>, too. When implementing
              the
              <code class="hljs">ObjectiveChecker</code> interface, we need to implement both the <code
                class="hljs">OnEvent()</code> and
              <code class="hljs">IsSatisfied()</code> functions. To accurately measure time, I'm also keeping track of
              some variables
              using <code class="hljs">std::chrono</code>.
            </p>

            <pre><code>
class DoNothingObjectiveChecker : public Bequestor::ObjectiveChecker
{
public:
  DoNothingObjectiveChecker();

  void OnEvent(Bequestor::Objective const& objective, Bequestor::ObjectiveEvent const& event) override;
  bool IsSatisfied(Bequestor::Objective const& objective) const override;

private:
  bool started = false;
  std::chrono::high_resolution_clock::time_point lastTime;
  float secondsPassed = 0.0f;
};</code></pre>

            <p>
              Before implementing these functions, let's see what kind of events we will be sending. We want the time to
              continuously update when the player does nothing, but to reset if the player does something. Let's
              distinguish between doing something or nothing with an event parameter. When we do nothing on a frame, we
              send an event as follows:
            </p>

            <pre><code>void Game::Update(float dt)
{
  Bequestor::ObjectiveEvent didNothingEvent = Bequestor::ObjectiveEvent("Do Nothing");
  didNothingEvent.AddParameter("Did Something", false);
  Notify(didNothingEvent);
}</code></pre>

            <p>
              "Do Nothing" is simply the objective type name. We specify this so the quest manager can find the attached
              <code class="hljs">ObjectiveChecker</code>. We also attach a boolean parameter that we give the name "Did
              Something".
              We
              send an event with a different value for this boolean whenever the player moves or interact.
            </p>

            <pre><code>void Game::handleKeyboardInput()
{ // (if the player moves or interacts:)
  Bequestor::ObjectiveEvent didNothingEvent = Bequestor::ObjectiveEvent("Do Nothing");
  didNothingEvent.AddParameter("Did Something", true);
  Notify(didNothingEvent);
}</code></pre>

            <p>
              Now we can handle this event in our <code class="hljs">DoNothingObjectiveChecker::OnEvent()</code>
              function. We use the
              <code class="hljs">started</code> boolean just so the timer starts running when the first event is caught.
              We also set
              an
              objective state variable, named "seconds". We will have to make sure to register this variable later.
              Finally, I'm using the <code class="hljs">std::chrono</code> namespace.
            </p>

            <pre><code>void DoNothingObjectiveChecker::OnEvent(Objective const& objective, ObjectiveEvent const& event)
{
  if (!started || event.Get&lt;bool>("Did Something"))
  {
    objective.state->Set("seconds", 0.0f);
    lastTime = high_resolution_clock::now();
    if (!started) started = true;
  }
  else
  {
    float secondsPassedSinceLastEvent = duration&lt;float>(high_resolution_clock::now() - lastTime).count();
    objective.state->Set("seconds", secondsPassedSinceLastEvent);
  }
}</code></pre>

            <p>
              We also have to implement the <code class="hljs">IsSatisfied()</code> function, where we simply compare
              our state
              variable to the "seconds" specified in the quest creator (5, in our case):
            </p>

            <pre class="hljs">
bool DoNothingObjectiveChecker::IsSatisfied(Objective const& objective) const
{
  return objective.state->Get&lt;float>("seconds") >= objective.Get&lt;float>("seconds");
}</pre>

            <p>
              Finally, we register our custom <code class="hljs">ObjectiveChecker</code> to our <code
                class="hljs">QuestManager</code> analogous
              to
              how we did it for the custom <code class="hljs">PrerequisiteChecker</code>, by using the
              <code class="hljs">QuestManager::WithCustomObjectiveChecker</code> function, which again takes a string
              referring to
              the
              custom type name, and a shared pointer to this time an <code class="hljs">ObjectiveChecker</code>, but
              there is one
              more
              optional parameter for state parameters and their staring values. We can name these parameters anything we
              want, and the type is automatically inferred. We simply name it the same as our objective parameter,
              "seconds", with a starting value of 0.0f (indicating it's a float). This is the state variable we were
              updating in our <code class="hljs">DoNothingObjectiveChecker::OnEvent()</code> function. Below is the code
              used to
              register our custom <code class="hljs">ObjectiveChecker</code>.
            </p>

            <pre class="hljs">
questManager = make_shared&lt;QuestManager>(
  QuestManager()
  /*(with preset checkers and custom prerequisite checker)*/
  .WithCustomObjectiveChecker("Do Nothing", make_shared&lt;DoNothingObjectiveChecker>(), {{"seconds", 0.0f}})
);
</pre>

            <p>
              Below is a screenshot of my demo game showing the custom objective in progress.
            </p>

            <img src="images/blog/quest_custom_objective.png"
              alt="A screenshot of the game where the player in in the cave area and the quest is shown with the custom &quot;Do Nothing&quot; objective in progress.">

            <h4 class="collapsible">Under the hood</h4>
            <div class="collapsible_content">
              <p>
                TODO
              </p>
            </div>

            <h3>Objective dependencies</h3>

            <p>
              What if we want objectives that depend on one another, or that can branch, have multiple ways of
              completion?
              For this we can use objective dependencies. Let's say to complete the quest, the plyer either has to wait
              5
              seconds, or they have to talk to Alfred and kill a bat. Either way they have to travel outside of the cave
              to the grassy area to complete the quest.
            </p>

            <p>
              We open back up the quest in the quest creator. We add objectives for killing a bat, and reaching the
              grass
              area. Different dependencies represent branches; the current objective can only be started if either of
              these dependencies is complete. Within a dependency, we can specify multiple objectives that <em>all</em>
              need be complete for the entire dependency to be complete. So, for the "Travel Place" quest, we
              press the little "+/-" icon to add or remove objectives to our first dependency, and we add the "Do
              Nothing"
              objective. Then we add a new dependency, press the "+/-" icon for that dependency, and add both the "Talk
              to
              Alfred" and "Kill a bat" objectives. The numbers behind the objective correspond to its ID; make sure you
              pick the right ones. Finally, we need to mark all objectives <em>but</em> the "Travel Place" objective as
              "optional", otherwise the quest will not be marked as complete until all objectives are complete,
              regardless
              of their individual dependencies. We export once again as <code class="hljs">batman_quests.json</code>
            </p>

            <img src="images/blog/quest_creator_dependent_objectives_1.png"
              alt="Quest creation window showing the newly created objectives.">
            <img src="images/blog/quest_creator_dependent_objectives_2.png"
              alt="Quest creation window showing the 2 objectives marked as optional, and the final objective with dependencies on the other objectives.">

            <p>
              With these new objectives, we need to make sure we actually send events when we travel to a place, but
              other
              than that, we won't have to change anything in the demo game.
            </p>

            <pre class="hljs">
void Game::handleAreaUpdates()
{
  // (...)
  Notify(Bequestor::ObjectiveEvent::MakeLocationEvent(area.name));
  // (...)
}</pre>
            <p>
              In the demo game, you can see as long as the player hasn't done nothing for 5 seconds and also hasn't both
              talked to Alfred and killed a bat, the "Travel Place" objective displays a "DEPENDENCIES NOT MET" message.
              Otherwise, the "Travel Place" objective <em>is</em> active, and the quest will complete upon entering the
              grass.
            </p>

            <img src="images/blog/quest_objective_dependencies_not_met.png"
              alt="A screenshot of the game where the player in in the cave area and the quest is shown with all objective shown, but none completed, so the &quot;Travel Place&quot; objective shows &quot;DEPENDENCIES NOT MET&quot;.">
            <img src="images/blog/quest_objective_dependencies_met_1.png"
              alt="A screenshot of the game where the player in in the cave area and the quest is shown with all objective shown, and the &quot;Do Nothing&quot; objective completed so the &quot;Travel Place&quot; objective is active.">
            <img src="images/blog/quest_objective_dependencies_met_2.png"
              alt="A screenshot of the game where the player in in the cave area and the quest is shown with all objective shown, and the &quot;Talk To NPC&quot; and &quot;Kill Creature&quot; objectives completed so the &quot;Travel Place&quot; objective is active.">
            <img src="images/blog/quest_objective_dependencies_complete.png"
              alt="A screenshot of the game where the player in in the grass area and the quest window is empty again.">
          </div>
          <h2>Conclusion</h2>
          <p>
            In what essentially has been the user guide for <em>Bequestor</em>, we have gone over all the features that
            the current version of the tool has to offer. We have created quests with prerequisites and objectives that
            can be preset ones or fully custom ones, and with possible optional objectives and dependencies between
            objectives. We have then exported these quests to a JSON, and imported them into our own game, using the
            <em>Bequestor</em> library. We also registered the necessary prerequisite and objective checkers, and
            parameters, and sent out the appropriate events so our quests update accordingly.
          </p>

          <h4 class="collapsible">Under the hood</h4>
          <div class="collapsible_content">
            <p>
              TODO
            </p>
          </div>
        </div>
      </div>
    </section>

  </div> <!-- end s-pagewrap -->
  <!-- Java Script
    ================================================== -->
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>
  <script src="js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

</body>

</html>